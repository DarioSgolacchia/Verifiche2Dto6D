<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>Verifiche 2Dto6D</title>
  <link rel="shortcut icon" href="images/logo-nero-solo-cerchi-2dto6d-150x150.png" type="image/x-icon">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <style>
    html {
      font-family: sans-serif;
    }

    body {
      margin: 0;
    }

    header {
      display: flex;
      background: gray;
      height: 100px;
      align-items: center;
      padding: 0 20px;
      color: black;
    }

    .Logo {
      flex: 1;
      max-height: auto;
      text-align: left;
    }

    .Cliente {
      flex: 1;
      max-height: 250px;
    }

    .Titolo {
      flex: 1;
      text-align: center;
    }

    .Contatti {
      flex: 1;
      text-align: right;
    }

    section {
      display: flex;
      flex-wrap: wrap;
    }

    .Main {
      padding: 10px;
      margin: 10px;
      background: lightgrey;
      flex: 600px;
    }

    .Side,
    footer {
      padding: 10px;
      margin: 10px;
      background: lightgrey;
      flex: 300px;
    }
    .Other,
    footer {
      padding: 10px;
      margin: 10px;
      background: lightgrey;
      flex: 100px;
    }
    .Dati,
    #myTable {
      border-collapse: collapse;
      width: 100%;
    }

    .Dati td,
    #myTable td {
      border: 1px solid #000000;
      padding: 8px;
      text-align: center;
    }

    .Dati th,
    #myTable th {
      background-color: #f2f2f2;
    }

    .TabellaLineeGuida,
    #myTable {
      border-collapse: collapse;
      width: 100%;
    }

    .TabellaLineeGuida td,
    #myTable td {
      border: 1px solid #000000;
      padding: 8px;
      text-align: center;
    }

    .TabellaLineeGuida th,
    #myTable th {
      background-color: #f2f2f2;
    }
    button {
      text-align: center;
    }
/* Resize and center pie chart */
#pieChart {
  max-width: 500px; /* Set the maximum size */
  width: 100%;
  margin: 0 auto; /* Center the pie chart horizontally */
  display: block; /* Ensure it behaves like a block element for centering */
}

  </style>
</head>

<body>
  <header>
    <div class="Logo">
      <img src="images/logo-completo-2dto6d-piccolo.png" alt="Logo">
    </div>
    <div class="Titolo">
      <h1>Verifica Modelli</h1>
    </div>
    <div class="Contatti">
      <a href="mailto:d.sgolacchia@2dto6d.com?cc=v.bressan@2dto6d.com&subject=Prova">Contattaci</a>
    </div>
  </header>

  <section>
    <article class="Side">
      <h2>Allegato 1 - Checklist</h2>
      <p>Gestione per verifica modelli</p>
      <p><img class="Cliente" src="images/bologna_750x375.jpg" alt="Logo" border="2"></p>
      <table class="Dati" border="2">
        <thead id="DatiHeader"></thead>
        <tbody id="DatiBody"></tbody>
      </table>
      <h1>Linee Guida</h1>
      <table class="TabellaLineeGuida" border="2">
        <thead id="LineeGuidaHeader"></thead>
        <tbody id="LineeGuidaBody"></tbody>
      </table>
    </article>

    <article class="Main">
      <h2>Riepilogo Verifiche</h2>
      <table id="myTable" border="2">
        <thead id="tableHeader"></thead>
        <tbody id="tableBody"></tbody>
      </table>
            <!-- Summary Section for Checkbox Counts -->
            <div id="checkboxSummary" style="margin-top: 10px;">
              <p id="totalElements">Totale Verifiche: 0</p>
              <p id="checkedElements">Verifiche corrette: 0</p>
              <p id="uncheckedElements">Verifiche da correggere: 0</p>
            </div>
    </article>
    <article class="Other">
      <h2>Stato di salute generale del Modello</h2>
      <canvas id="pieChart" width="400" height="400"></canvas>

      <script>
 // Funzione per caricare e analizzare il CSV
 function loadPieCSV() {
      Papa.parse('CSVExport.csv', {
        download: true,
        header: true,
        complete: function(results) {
          createPieChart(results.data);
        }
      });
    }

    // Funzione per creare il grafico a torta
    function createPieChart(data) {
      const labels = ['Verifiche Corrette', 'Verifiche Incorrette'];
      const values = [0, 0];

      // Conta gli Stati 1 e 0 nel CSV
      data.forEach(row => {
        if (row.Stato.trim() === '1') {
          values[0]++;
        } else if (row.Stato.trim() === '0') {
          values[1]++;
        }
      });

      // Crea il grafico a torta con i dati
      const ctx = document.getElementById('pieChart').getContext('2d');
      const pieChart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: labels,
          datasets: [{
            label: 'Distribuzione Stato',
            data: values,
            backgroundColor: ['#36A2EB','#FF6384'],
          }]
        }
      });

      // Mostra le statistiche sotto il grafico
      displayStatistics(values[0] + values[1], values[0], values[1]);
    }

    // Funzione per mostrare le statistiche sotto il grafico
    function displayStatistics(total, stato1, stato0) {
      const stats = `Totale elementi: ${total}, Verifiche corrette: ${stato1}, Verifiche da correggere: ${stato0}`;
      document.getElementById('statistics').textContent = stats;
    }

    // Carica i CSV quando la pagina è pronta
    document.addEventListener('DOMContentLoaded', function() {
      loadPieCSV();
    });
      </script>
    </article>
  </section>

  <footer class="Footer">
    <button><a href="Pagina1.html">Pagina Successiva</a></button>
  </footer>
  
  <style>
    .Footer {
      display: flex;
      justify-content: flex-end; /* Allinea a sinistra */
      padding: 10px;
      margin: 10px;
      width: 100%;
    }
    
    .Footer button {
      margin: 0;
      padding: 10px 20px; /* Modifica le dimensioni del bottone */
      margin-right: 40px; /* Aggiungi spazio a destra del bottone */
    }
  
    .Footer button a {
      text-decoration: none; /* Rimuove la sottolineatura */
      color: black; /* Colore del testo */
    }
  </style>
  
  <script>
    async function loadDatiCSV() {
      try {
        const response = await fetch('Dati.csv');
        const data = await response.text();

        const rows = data.trim().split('\n').map(row => row.split(','));

        const tableHeader = document.getElementById('DatiHeader');
        const tableBody = document.getElementById('DatiBody');

        // Creazione della riga di intestazione
        const headerRow = document.createElement('tr');
        rows[0].forEach(headerCell => {
          const th = document.createElement('th');
          th.textContent = headerCell;
          headerRow.appendChild(th);
        });
        tableHeader.appendChild(headerRow);

        // Popola il corpo della tabella
        rows.slice(1).forEach(row => {
          const tr = document.createElement('tr');
          row.forEach(cell => {
            const td = document.createElement('td');
            td.textContent = cell;
            tr.appendChild(td);
          });
          tableBody.appendChild(tr);
        });
      } catch (error) {
        console.error('Errore durante il caricamento del CSV Dati:', error);
      }
    }



    async function loadLineeGuidaCSV() {
      try {
        const response = await fetch('LineeGuida.csv');
        const data = await response.text();

        const rows = data.trim().split('\n').map(row => row.split(','));

        const tableHeader = document.getElementById('LineeGuidaHeader');
        const tableBody = document.getElementById('LineeGuidaBody');

        // Creazione della riga di intestazione
        const headerRow = document.createElement('tr');
        rows[0].forEach(headerCell => {
          const th = document.createElement('th');
          th.textContent = headerCell;
          headerRow.appendChild(th);
        });
        tableHeader.appendChild(headerRow);

        // Popola il corpo della tabella
        rows.slice(1).forEach(row => {
          const tr = document.createElement('tr');
          row.forEach(cell => {
            const td = document.createElement('td');
            td.textContent = cell;
            tr.appendChild(td);
          });
          tableBody.appendChild(tr);
        });
      } catch (error) {
        console.error('Errore durante il caricamento del CSV LineeGuida:', error);
      }
    }

    async function loadCSV() {
      try {
        const response = await fetch('CSVExport.csv');
        const data = await response.text();

        const rows = data.trim().split('\n').map(row => row.split(','));

        const tableHeader = document.getElementById('tableHeader');
        const tableBody = document.getElementById('tableBody');

        // Creazione della riga di intestazione e individuazione dell'indice della colonna "Stato"
        const headerRow = document.createElement('tr');
        let statoIndex = -1;

        rows[0].forEach((header, index) => {
          const th = document.createElement('th');
          th.textContent = header;
          headerRow.appendChild(th);

          if (header.trim().toLowerCase() === "stato") {
            statoIndex = index;
          }
        });

        tableHeader.appendChild(headerRow);

        // Popola il corpo della tabella
        rows.slice(1).forEach(row => {
          const tr = document.createElement('tr');
          row.forEach(cell => {
            const td = document.createElement('td');
            td.textContent = cell;
            tr.appendChild(td);
          });
          tableBody.appendChild(tr);
        });

        // Aggiungi i checkbox alle celle della colonna "Stato" se trovata
        if (statoIndex !== -1) {
          addCheckboxes(statoIndex);
        } else {
          console.warn('Colonna "Stato" non trovata nel CSV');
        }
      } catch (error) {
        console.error('Errore nel caricamento del file CSV:', error);
      }
    }

    function addCheckboxes(statoIndex) {
      const table = document.getElementById("myTable");

      // Itera su ogni riga della tabella (saltando la prima, che è l'intestazione)
      for (let i = 1; i < table.rows.length; i++) {
        const cell = table.rows[i].cells[statoIndex];

        // Crea un nuovo checkbox disabilitato
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.disabled = true;

        // Imposta lo stato del checkbox in base al valore della cella
        const cellValue = cell.textContent.trim().toLowerCase();
        checkbox.checked = (cellValue === "1" || cellValue === "true");

        // Sostituisci il contenuto della cella con il checkbox
        cell.textContent = "";
        cell.appendChild(checkbox);
      }
    }
    function addCheckboxes(statoIndex) {
      const table = document.getElementById("myTable");

      for (let i = 1; i < table.rows.length; i++) {
        const cell = table.rows[i].cells[statoIndex];
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.disabled = true;

        const cellValue = cell.textContent.trim().toLowerCase();
        checkbox.checked = (cellValue === "1" || cellValue === "true");

        cell.textContent = "";
        cell.appendChild(checkbox);
      }

      // Call function to update checkbox summary
      updateCheckboxSummary();
    }

    function updateCheckboxSummary() {
      const table = document.getElementById("myTable");
      let totalElements = 0;
      let checkedElements = 0;
      let uncheckedElements = 0;

      for (let i = 1; i < table.rows.length; i++) {
        const checkbox = table.rows[i].cells[table.rows[0].cells.length - 1].querySelector('input[type="checkbox"]');
        if (checkbox) {
          totalElements++;
          if (checkbox.checked) {
            checkedElements++;
          } else {
            uncheckedElements++;
          }
        }
      }
      document.getElementById("totalElements").textContent = `Totale Verifiche: ${totalElements}`;
      document.getElementById("checkedElements").textContent = `Verifiche corrette: ${checkedElements}`;
      document.getElementById("uncheckedElements").textContent = `Verifiche da correggere: ${uncheckedElements}`;
    }
    // Funzione per mostrare le statistiche sotto il grafico
    function displayStatistics(total, stato1, stato0) {
      const stats = `Totale elementi: ${total}, Stato 1: ${stato1}, Stato 0: ${stato0}`;
      document.getElementById('statistics').textContent = stats;
    }
    // Funzione per mostrare le statistiche sotto il grafico
    function displayStatistics(total, stato1, stato0) {
      const stats = `Totale elementi: ${total}, Stato 1: ${stato1}, Stato 0: ${stato0}`;
      document.getElementById('statistics').textContent = stats;
    }

    document.addEventListener('DOMContentLoaded', loadPieCSV);

    document.addEventListener('DOMContentLoaded', () => {
      // Esegui il caricamento dei CSV normalmente
      loadDatiCSV();
      loadLineeGuidaCSV();
      loadCSV();
      loadPieCSV();
  });
  </script>
</body>
</body>

</html>